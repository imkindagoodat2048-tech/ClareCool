<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClareCool V1.2</title>
    
    <script>
        (function() {
            const favicon = document.createElement('link');
            favicon.rel = 'icon';
            favicon.href = 'clarecool.png'; 
            document.head.appendChild(favicon);
        })();
    </script>

    <style>
        :root {
            --bg-color: #0f0f13;
            --chat-bg: #1a1a20;
            --primary: #6c5ce7; 
            --danger: #ff4757;
            --text-white: #ffffff;
            --msg-self: #6c5ce7;
            --msg-other: #2d2d3a;
        }

        @keyframes rainbow {
            0% { color: #ff4757; } 20% { color: #ffa502; } 40% { color: #eccc68; }
            60% { color: #2ed573; } 80% { color: #1e90ff; } 100% { color: #ff4757; }
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-white); margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }

        /* Classic Auth Screen */
        #auth-container { align-self: center; background: var(--chat-bg); padding: 40px; border-radius: 20px; width: 320px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid #333; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; box-sizing: border-box; background: #0f0f13; border: 1px solid #333; color: white; border-radius: 8px; outline: none; }
        
        /* Buttons */
        button { padding: 10px 15px; border: none; border-radius: 8px; background: var(--primary); color: white; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { opacity: 0.9; transform: scale(0.98); }

        /* Classic Chat Layout */
        #chat-wrapper { width: 100%; max-width: 900px; height: 100vh; display: flex; flex-direction: column; background: var(--chat-bg); border-left: 1px solid #333; border-right: 1px solid #333; }
        #top-bar { padding: 15px 20px; background: rgba(26, 26, 32, 0.95); border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; overflow-x: auto; gap: 10px; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }

        /* Rainbow Admin Tag */
        .admin-tag { animation: rainbow 3s linear infinite; font-weight: 900; font-size: 10px; margin-left: 5px; }

        /* Classic Messages */
        .message-row { display: flex; align-items: flex-end; gap: 10px; max-width: 80%; }
        .row-self { align-self: flex-end; flex-direction: row-reverse; }
        .msg-bubble { padding: 10px 15px; border-radius: 18px; font-size: 15px; line-height: 1.4; word-wrap: break-word; position: relative; }
        .row-self .msg-bubble { background: var(--msg-self); color: white; border-bottom-right-radius: 4px; }
        .row-other .msg-bubble { background: var(--msg-other); color: #ddd; border-bottom-left-radius: 4px; }
        .pfp-small { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 2px solid #333; }

        /* Modals */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal-box { background: #1e1e24; padding: 30px; border-radius: 20px; width: 350px; text-align: center; border: 1px solid #444; max-height: 80vh; overflow-y: auto; }
        
        #input-area { padding: 20px; background: var(--chat-bg); border-top: 1px solid #333; display: flex; gap: 10px; align-items: center; }
        .img-msg { max-width: 100%; border-radius: 10px; margin-top: 5px; border: 1px solid #444; }
        .member-card { background: #111; padding: 10px; border-radius: 8px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div id="auth-container">
        <h2>ClareCool V1.2</h2>
        <div style="font-size: 10px; color: var(--primary); margin-bottom: 15px; font-weight: bold; text-transform: uppercase;">The Security Update</div>
        <input type="text" id="username-in" placeholder="Username">
        <input type="password" id="password-in" placeholder="Password">
        <button onclick="handleAuth()" style="width: 100%;">Access Terminal</button>
        <p onclick="toggleAuthMode()" id="auth-toggle" style="cursor: pointer; color: #888; font-size: 11px; margin-top: 15px;">Need an account? Sign Up</p>
    </div>

    <div id="chat-wrapper" class="hidden">
        <div id="top-bar">
            <div style="display: flex; align-items: center; gap: 8px;">
                <img id="my-mini-pfp" class="pfp-small" onclick="openModal('settings')">
                <select id="room-select" onchange="switchRoom(this.value)" style="width: auto; padding: 4px; font-size: 10px; margin:0;">
                    <option value="messages">Main Terminal</option>
                </select>
                <button onclick="openModal('members')" style="font-size: 10px; padding: 5px;">üë• Members</button>
                <button onclick="openModal('rules')" style="font-size: 10px; padding: 5px;">üìú Rules</button>
                <button id="meet-btn" class="hidden" onclick="triggerMeeting()" style="font-size: 10px; padding: 5px; background: var(--danger);">üö® Meeting</button>
                <button id="inbox-btn" class="hidden" onclick="openModal('inbox')" style="font-size: 10px; padding: 5px; background: #e67e22;">üì• Inbox</button>
                <button id="gc-btn" class="hidden" onclick="openModal('create-gc')" style="font-size: 10px; padding: 5px; background: #2ed573;">‚ûï GC</button>
                <button id="nerd-btn" class="hidden" onclick="openModal('nerd')" style="font-size: 10px; padding: 5px; background: var(--info);">ü§ì Stats</button>
            </div>
            <button onclick="location.reload()" style="background: #444; font-size: 11px;">Exit</button>
        </div>
        <div id="messages"></div>
        <div id="input-area">
            <div id="admin-photo-zone" class="hidden">
                <label for="img-input" style="cursor:pointer; font-size: 18px;">üñºÔ∏è</label>
                <input type="file" id="img-input" accept="image/*" style="display:none;" onchange="bufferImage(this)">
            </div>
            <input type="text" id="msg-input" placeholder="Enter transmission..." onkeypress="if(event.key==='Enter') send()">
            <button onclick="send()">Send</button>
        </div>
    </div>

    <div id="master-modal" class="modal-overlay hidden">
        <div class="modal-box" id="modal-content"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB9Rlvq49-AiLBzMDvjz71QCTT4d6NqE98",
            authDomain: "mychat-28205.firebaseapp.com",
            databaseURL: "https://mychat-28205-default-rtdb.firebaseio.com",
            projectId: "mychat-28205",
            storageBucket: "mychat-28205.firebasestorage.app",
            messagingSenderId: "522121848657",
            appId: "1:522121848657:web:7108993439310bf6da5570"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentUser = null, currentRoom = "messages", isLogin = true, imgBuffer = null;
        const adminList = ["44", "hunter", "bboy2014", "bartelsfamily5"];

        function toggleAuthMode() {
            isLogin = !isLogin;
            document.getElementById('auth-toggle').innerText = isLogin ? "Need an account? Sign Up" : "Have an account? Login";
        }

        async function handleAuth() {
            const u = document.getElementById('username-in').value.trim().toLowerCase();
            const p = document.getElementById('password-in').value.trim();
            if(!u || !p) return;
            const snap = await db.ref("users/" + u).once("value");
            if(isLogin) {
                if(snap.exists() && snap.val().password === p) launch(u);
                else alert("Auth Failed.");
            } else {
                if(snap.exists()) return alert("User exists.");
                await db.ref("users/" + u).set({ password: p, pfp: "", status: "Active" });
                launch(u);
            }
        }

        function launch(user) {
            currentUser = user;
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('chat-wrapper').classList.remove('hidden');
            if(adminList.includes(user)) {
                ["meet-btn", "inbox-btn", "gc-btn", "admin-photo-zone"].forEach(id => document.getElementById(id).classList.remove('hidden'));
            }
            if(user === "bartelsfamily5") document.getElementById('nerd-btn').classList.remove('hidden');
            loadMessages();
            loadGCs();
        }

        function bufferImage(input) {
            const reader = new FileReader();
            reader.onload = (e) => { imgBuffer = e.target.result; alert("Image Buffered."); };
            reader.readAsDataURL(input.files[0]);
        }

        function send() {
            const txt = document.getElementById('msg-input').value.trim();
            if(!txt && !imgBuffer) return;
            db.ref(currentRoom).push({ sender: currentUser, text: txt, img: imgBuffer, time: Date.now() });
            document.getElementById('msg-input').value = ""; imgBuffer = null;
        }

        function loadMessages() {
            db.ref(currentRoom).on("value", snap => {
                const box = document.getElementById('messages');
                box.innerHTML = "";
                snap.forEach(c => {
                    const m = c.val(), isMe = m.sender === currentUser, isAdmin = adminList.includes(m.sender);
                    const row = document.createElement('div');
                    row.className = `message-row ${isMe ? 'row-self' : 'row-other'}`;
                    row.innerHTML = `
                        <img src="${m.pfp || 'https://via.placeholder.com/40'}" class="pfp-small">
                        <div>
                            <div style="font-size:10px; color:#666;">${m.sender}${isAdmin ? '<span class="admin-tag">[ADMIN]</span>':''}</div>
                            <div class="msg-bubble">
                                ${m.text || ''}
                                ${m.img ? `<img src="${m.img}" class="img-msg">` : ''}
                            </div>
                        </div>`;
                    box.appendChild(row);
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        function openModal(type) {
            const mc = document.getElementById('modal-content');
            mc.innerHTML = "";
            if(type === 'rules') {
                mc.innerHTML = `<h3>üìú Rules</h3><p>1. No Spam<br>2. Respect Admins<br>3. No Hate Speech</p>`;
            } else if(type === 'members') {
                mc.innerHTML = `<h3>Members</h3><div id="m-list"></div>`;
                db.ref("users").once("value", s => s.forEach(u => {
                    document.getElementById('m-list').innerHTML += `<div class="member-card"><span>${u.key}</span></div>`;
                }));
            } else if(type === 'nerd') {
                mc.innerHTML = `<h3>ü§ì Nerd Stats</h3><button onclick="wipe()" style="background:red;">NUCLEAR WIPE</button>`;
            } else if(type === 'create-gc') {
                mc.innerHTML = `<h3>New GC</h3><input id="gn" placeholder="Name"><input id="gm" placeholder="Users (comma separated)"><button onclick="makeGC()">Create</button>`;
            }
            mc.innerHTML += `<button onclick="closeModal()" style="margin-top:15px; background:#444;">Close</button>`;
            document.getElementById('master-modal').classList.remove('hidden');
        }

        function makeGC() {
            const name = document.getElementById('gn').value, members = document.getElementById('gm').value.split(',').map(u => u.trim());
            members.push(currentUser);
            db.ref("gc_meta").push({ name, members });
            closeModal();
        }

        function loadGCs() {
            db.ref("gc_meta").on("value", snap => {
                const sel = document.getElementById('room-select');
                sel.innerHTML = `<option value="messages">Main Terminal</option>`;
                snap.forEach(g => {
                    if(g.val().members.includes(currentUser)) {
                        sel.innerHTML += `<option value="gcs/${g.key}">${g.val().name}</option>`;
                    }
                });
            });
        }

        function wipe() { if(confirm("WIPE EVERYTHING?")) { db.ref("messages").remove(); db.ref("gcs").remove(); alert("Data Cleared."); } }
        function closeModal() { document.getElementById('master-modal').classList.add('hidden'); }
        function switchRoom(r) { currentRoom = r; loadMessages(); }
        function triggerMeeting() { db.ref("reports").push({ type: "MEETING_CALL", sender: currentUser }); alert("Call dispatched."); }
    </script>
</body>
</html>
